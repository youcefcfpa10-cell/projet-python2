# -*- coding: utf-8 -*-
from PyQt5 import QtCore, QtGui, QtWidgets
import json
import os
import sys
import subprocess

class WelcomeNext(QtWidgets.QDialog):
    def __init__(self, current_user, passwords):
        super().__init__()
        self.current_user = current_user
        self.passwords = passwords
        self.setupUi()

    def setupUi(self):
        self.setWindowTitle("ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ø±ÙˆØ¬")
        self.setWindowFlag(QtCore.Qt.WindowCloseButtonHint, False)  # ØªØ¹Ø·ÙŠÙ„ Ø²Ø± X
        self.resize(600, 450)
        self.setStyleSheet("background-color: #D35400; color: white;")
        icon_path = "images/ITP1.ico"
        if os.path.exists(icon_path):
            self.setWindowIcon(QtGui.QIcon(icon_path))

        # Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø§Ø³ØªÙÙ‡Ø§Ù… â“
        self.label = QtWidgets.QLabel("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ â“", self)
        self.label.setGeometry(QtCore.QRect(150, 20, 300, 50))
        self.label.setFont(QtGui.QFont("Arial", 12, QtGui.QFont.Bold))
        self.label.setAlignment(QtCore.Qt.AlignCenter)
        self.label.setStyleSheet("border: 4px solid #FFFFFF; border-radius: 5px; padding: 5px;")

        # Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª
        self.welcome_label = QtWidgets.QLabel("Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", self)
        self.welcome_label.setGeometry(QtCore.QRect(60, 80, 500, 55))
        self.welcome_label.setFont(QtGui.QFont("Arial", 20, QtGui.QFont.Bold))
        self.welcome_label.setAlignment(QtCore.Qt.AlignCenter)
        self.welcome_label.setStyleSheet("border: 4px solid #FFFFFF; border-radius: 5px; padding: 5px;")

        self.welcome_label_2 = QtWidgets.QLabel("ØªØ­ÙŠØ§ØªÙŠ Ù„ÙƒÙ… Ùˆ Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚", self)
        self.welcome_label_2.setGeometry(QtCore.QRect(60, 140, 500, 55))
        self.welcome_label_2.setFont(QtGui.QFont("Arial", 20, QtGui.QFont.Bold))
        self.welcome_label_2.setAlignment(QtCore.Qt.AlignCenter)
        self.welcome_label_2.setStyleSheet("border: 4px solid #FFFFFF; border-radius: 5px; padding: 5px;")

        self.welcome_label_3 = QtWidgets.QLabel("Ø£Ø®ÙˆÙƒÙ… Ø§Ù„Ù…ÙØªØ´ Ø³Ù…Ø§Ø­ÙŠ ÙŠÙˆØ³Ù", self)
        self.welcome_label_3.setGeometry(QtCore.QRect(60, 200, 500, 50))
        self.welcome_label_3.setFont(QtGui.QFont("Arial", 18, QtGui.QFont.Bold))
        self.welcome_label_3.setAlignment(QtCore.Qt.AlignCenter)
        self.welcome_label_3.setStyleSheet("border: 4px solid #FFFFFF; border-radius: 5px; padding: 5px;")

        # Ø²Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ù…Ø¹ Ø§Ù„ØªÙ„Ø§Ø´ÙŠ
        btn_save_exit = QtWidgets.QPushButton("ğŸ’¾ Ø¥ØºÙ„Ø§Ù‚", self)
        btn_save_exit.setGeometry(QtCore.QRect(150, 320, 140, 50))
        btn_save_exit.setStyleSheet("background-color: white; color: black; font-weight: bold; font-size: 14px;")
        btn_save_exit.clicked.connect(self.fade_and_save_exit)

        # Ø²Ø± Ø§Ù„ØªØ±Ø§Ø¬Ø¹
        btn_back = QtWidgets.QPushButton("â¬…ï¸ ØªØ±Ø§Ø¬Ø¹", self)
        btn_back.setGeometry(QtCore.QRect(310, 320, 140, 50))
        btn_back.setStyleSheet("background-color: white; color: black; font-weight: bold; font-size: 14px;")
        btn_back.clicked.connect(self.fade_and_go_back)

    # --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ„Ø§Ø´ÙŠ Ù„ÙƒÙ„ Ø²Ø± ---
    def fade_and_save_exit(self):
        self.animation = QtCore.QPropertyAnimation(self, b"windowOpacity")
        self.animation.setDuration(500)
        self.animation.setStartValue(1)
        self.animation.setEndValue(0)
        self.animation.finished.connect(self.save_exit)
        self.animation.start()

    def fade_and_go_back(self):
        self.animation = QtCore.QPropertyAnimation(self, b"windowOpacity")
        self.animation.setDuration(500)
        self.animation.setStartValue(1)
        self.animation.setEndValue(0)
        self.animation.finished.connect(self.open_gestion)
        self.animation.start()

    # --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„ÙƒÙ„ Ø²Ø± ---
    def save_exit(self):
        with open("passwords.json", "w", encoding="utf-8") as f:
            json.dump(self.passwords, f, ensure_ascii=False, indent=4)
        QtWidgets.QMessageBox.information(self, "ØªÙ… Ø§Ù„Ø­ÙØ¸", "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬.")

    def open_gestion(self):
        self.close()
        subprocess.Popen([sys.executable, "GESTION.py"])

# --- ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ø°Ø§ ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ù„Ù ---
if __name__ == "__main__":
    app = QtWidgets.QApplication(sys.argv)
    window = WelcomeNext(current_user="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ", passwords={})
    window.show()
    sys.exit(app.exec_())
